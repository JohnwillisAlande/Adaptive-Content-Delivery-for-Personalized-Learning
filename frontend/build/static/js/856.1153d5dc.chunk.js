"use strict";(self.webpackChunkapex101_frontend=self.webpackChunkapex101_frontend||[]).push([[856],{856:(e,s,i)=>{i.r(s),i.d(s,{default:()=>x});var n=i(43),a=i(439),l=i(939),c=i.n(l),r=i(204),t=i(488),d=i(768),o=i(697),u=i(579);const h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null==e?"0":e.toLocaleString()},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!e)return"0 min";const s=Math.round(e/60);return"".concat(s.toLocaleString()," min")};const x=function(){var e,s;const{courseId:i}=(0,a.g)(),l=(0,a.Zp)(),{user:x}=(0,o.A)(),j="Admin"===(null===x||void 0===x?void 0:x.userType),v="Teacher"===(null===x||void 0===x?void 0:x.userType),[p,_]=(0,n.useState)(!0),[b,N]=(0,n.useState)(null),[y,g]=(0,n.useState)(null),[f,S]=(0,n.useState)(!1),w=(0,n.useMemo)(()=>j?"/courses/admin/".concat(i,"/metrics"):v?"/courses/teacher/".concat(i,"/metrics"):null,[j,v,i]),C=j?"/courses":"/teacher/courses";(0,n.useEffect)(()=>{if(!w)return t.oR.error("You are not authorized to view course metrics"),void l("/courses",{replace:!0});let e=!0;const s=async function(){let{showSpinner:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s?_(!0):S(!0);try{const{data:s}=await d.A.get(w);if(!e)return;N(s)}catch(a){var i,n;if(!e)return;t.oR.error((null===(i=a.response)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.error)||"Failed to load course metrics")}finally{if(!e)return;s?_(!1):S(!1)}};s({showSpinner:!0});const i=setInterval(()=>s({showSpinner:!1}),15e3);return()=>{e=!1,clearInterval(i)}},[i,l,w]);const k=(0,n.useMemo)(()=>{var e;return null!==b&&void 0!==b&&null!==(e=b.course)&&void 0!==e&&e.createdAt?new Date(b.course.createdAt).toLocaleString():"\u2014"},[null===b||void 0===b||null===(e=b.course)||void 0===e?void 0:e.createdAt]),A=(0,n.useMemo)(()=>{const e=null===b||void 0===b?void 0:b.metrics;if(!e)return[];const s={};return(e.formatBreakdown||[]).forEach(e=>{s[e.label]=e.count}),["Visual","Verbal","Audio"].map(e=>({label:e,count:s[e]||0}))},[null===b||void 0===b?void 0:b.metrics]),L=A.reduce((e,s)=>e+s.count,0),V=(null===b||void 0===b||null===(s=b.metrics)||void 0===s?void 0:s.materials)||[],I=e=>e?new Date(e).toLocaleString():"\u2014";if(p)return(0,u.jsx)("div",{className:"admin-course-analytics admin-course-analytics--loading",children:(0,u.jsx)(c(),{color:"#14b8a6",size:42})});if(!b)return(0,u.jsx)("div",{className:"admin-course-analytics",children:(0,u.jsxs)("div",{className:"admin-course-analytics__empty",children:[(0,u.jsx)("p",{children:"Unable to load course analytics."}),(0,u.jsx)("button",{type:"button",className:"inline-btn",onClick:()=>l(C),children:"Back to Courses"})]})});const{course:M,metrics:T}=b,B=[{label:"Students Enrolled",value:h(T.totalEnrollments),icon:(0,u.jsx)(r.YXz,{})},{label:"Total Visits",value:h(T.totalVisits),icon:(0,u.jsx)(r.qvi,{})},{label:"Learning Minutes",value:m(T.totalTimeSpentSeconds),icon:(0,u.jsx)(r.obD,{})},{label:"Materials Published",value:h(T.totalMaterials),icon:(0,u.jsx)(r.vd0,{})}];return(0,u.jsxs)("div",{className:"admin-course-analytics",children:[(0,u.jsxs)("button",{type:"button",className:"option-btn admin-course-analytics__back",onClick:()=>l(C),children:[(0,u.jsx)(r.QVr,{})," Back to Courses"]}),f&&(0,u.jsx)("span",{className:"admin-course-analytics__refresh-indicator",children:"Updating metrics\u2026"}),(0,u.jsxs)("div",{className:"admin-course-analytics__hero",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"admin-course-analytics__eyebrow",children:"Course Insights"}),(0,u.jsx)("h1",{children:M.title}),(0,u.jsx)("p",{children:M.description})]}),(0,u.jsxs)("dl",{children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("dt",{children:"Teacher"}),(0,u.jsx)("dd",{children:M.teacherName||"Unknown"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("dt",{children:"Created"}),(0,u.jsx)("dd",{children:k})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("dt",{children:"Status"}),(0,u.jsx)("dd",{children:M.suspended?"Suspended":"Active"})]})]})]}),(0,u.jsx)("div",{className:"admin-course-analytics__grid",children:B.map(e=>(0,u.jsxs)("article",{className:"admin-course-analytics__tile",children:[(0,u.jsx)("div",{className:"admin-course-analytics__tile-icon",children:e.icon}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:e.label}),(0,u.jsx)("p",{className:"value",children:e.value})]})]},e.label))}),(0,u.jsxs)("section",{className:"admin-course-analytics__section",children:[(0,u.jsx)("h2",{children:"Engagement Metrics"}),(0,u.jsxs)("div",{className:"admin-course-analytics__stats",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Unique Learners"}),(0,u.jsx)("p",{className:"value",children:h(T.uniqueLearners)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Average Time / Visit"}),(0,u.jsx)("p",{className:"value",children:m(T.averageTimePerVisit)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Completed Sessions"}),(0,u.jsxs)("p",{className:"value",children:[h(T.completionCount)," (",(100*T.completionRate).toFixed(1),"%)"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Last Interaction"}),(0,u.jsx)("p",{className:"value",children:T.lastInteractionAt?new Date(T.lastInteractionAt).toLocaleString():"\u2014"})]})]})]}),(0,u.jsxs)("section",{className:"admin-course-analytics__section admin-course-analytics__section--split",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h3",{children:"Materials by Category"}),(0,u.jsx)("ul",{children:(T.materialBreakdown||[]).map(e=>(0,u.jsxs)("li",{children:[(0,u.jsx)("span",{children:e.label}),(0,u.jsx)("strong",{children:h(e.count)})]},e.label))})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h3",{children:"Materials by Format"}),(0,u.jsx)("ul",{children:(T.formatBreakdown||[]).map(e=>(0,u.jsxs)("li",{children:[(0,u.jsx)("span",{children:e.label}),(0,u.jsx)("strong",{children:h(e.count)})]},e.label))})]})]}),(0,u.jsxs)("section",{className:"admin-course-analytics__section",children:[(0,u.jsx)("h3",{children:"Visual vs Verbal vs Audio"}),(0,u.jsxs)("div",{className:"format-distribution",children:[A.map(e=>{const s=L?e.count/L*100:0;return(0,u.jsxs)("div",{className:"format-distribution__row",children:[(0,u.jsx)("span",{className:"format-distribution__label",children:e.label}),(0,u.jsx)("div",{className:"format-distribution__bar",children:(0,u.jsx)("div",{style:{width:"".concat(s,"%")}})}),(0,u.jsx)("span",{className:"format-distribution__value",children:e.count})]},e.label)}),0===L&&(0,u.jsx)("p",{className:"muted",children:"No materials have been uploaded for this distribution yet."})]})]}),(0,u.jsxs)("section",{className:"admin-course-analytics__section",children:[(0,u.jsx)("h3",{children:"Recent Activity"}),T.recentInteractions&&T.recentInteractions.length?(0,u.jsx)("div",{className:"admin-course-analytics__recent",children:T.recentInteractions.map(e=>{var s;return(0,u.jsxs)("article",{className:"admin-course-analytics__recent-item",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Learner"}),(0,u.jsxs)("p",{children:["#",(e.userId||e.user_id||"").slice(-6)||"\u2014"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Category"}),(0,u.jsx)("p",{children:(null===(s=e.annotations)||void 0===s?void 0:s.category)||"\u2014"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Time Spent"}),(0,u.jsx)("p",{children:m(e.timeSpentSeconds)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"Completed"}),(0,u.jsx)("p",{children:e.completed?"Yes":"No"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"label",children:"When"}),(0,u.jsx)("p",{children:e.timestamp?new Date(e.timestamp).toLocaleString():"\u2014"})]})]},e._id||e.id)})}):(0,u.jsx)("p",{className:"text-muted",children:"No recent interactions captured."})]}),(0,u.jsxs)("section",{className:"admin-course-analytics__section admin-course-analytics__materials",children:[(0,u.jsx)("h3",{children:"Course Materials"}),0===V.length?(0,u.jsx)("p",{className:"muted",children:"No materials have been uploaded for this course."}):(0,u.jsx)("div",{className:"material-accordion",children:V.map(e=>{var s,i,n,a,l,c;const r=e._id||e.id,t=y===r;return(0,u.jsxs)("div",{className:"material-accordion__item".concat(t?" material-accordion__item--expanded":""),children:[(0,u.jsxs)("button",{type:"button",className:"material-accordion__header",onClick:()=>{return e=r,void g(s=>s===e?null:e);var e},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{children:e.title}),(0,u.jsxs)("p",{children:["Uploaded ",I(e.uploadedAt)]})]}),(0,u.jsxs)("div",{className:"material-accordion__meta",children:[(0,u.jsx)("span",{children:(null===(s=e.annotations)||void 0===s?void 0:s.format)||"\u2014"}),(0,u.jsx)("span",{children:(null===(i=e.annotations)||void 0===i?void 0:i.category)||"\u2014"})]})]}),t&&(0,u.jsxs)("div",{className:"material-accordion__details",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{children:"Clicks"}),(0,u.jsx)("strong",{children:h((null===(n=e.stats)||void 0===n?void 0:n.clicks)||0)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{children:"Avg View Time"}),(0,u.jsx)("strong",{children:m((null===(a=e.stats)||void 0===a?void 0:a.avgTimeSpentSeconds)||0)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{children:"Completions"}),(0,u.jsx)("strong",{children:h((null===(l=e.stats)||void 0===l?void 0:l.completions)||0)})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{children:"Last Viewed"}),(0,u.jsx)("strong",{children:I(null===(c=e.stats)||void 0===c?void 0:c.lastViewedAt)})]})]})]},r)})})]})]})}}}]);
//# sourceMappingURL=856.1153d5dc.chunk.js.map