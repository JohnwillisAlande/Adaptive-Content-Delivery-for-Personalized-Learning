"use strict";(self.webpackChunkapex101_frontend=self.webpackChunkapex101_frontend||[]).push([[809],{809:(e,a,t)=>{t.r(a),t.d(a,{default:()=>p});var l=t(555),n=t(43),s=t(439),i=t(939),r=t.n(i),o=t(488),c=t(204),d=t(768),u=t(697),m=t(579);const h={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"AIzaSyCrxqeqgsp8qubxzmo4Yvzzh7S7-0hzXEc",REACT_APP_GOOGLE_CLIENT_ID:"776006269077-683ndu3i60s7o3tu1bn1m1rb3mukc03u.apps.googleusercontent.com"}.REACT_APP_FILE_BASE_URL||"http://localhost:5000",x=e=>e?e.startsWith("blob:")||e.startsWith("http")?e:e.startsWith("/")?"".concat(h).concat(e):"".concat(h,"/uploaded_files/").concat(e):"";const p=function(){var e,a,t,i,h,p,v,g,b,f;const{courseId:j,materialId:w}=(0,s.g)(),N=(0,s.Zp)(),{user:y,refresh:_}=(0,u.A)(),[q,z]=(0,n.useState)(!0),[C,k]=(0,n.useState)(null),[S,A]=(0,n.useState)(null),[E,P]=(0,n.useState)([]),[D,I]=(0,n.useState)(!1),[R,T]=(0,n.useState)(null),[F,M]=(0,n.useState)(null),[L,O]=(0,n.useState)(0),[G,Q]=(0,n.useState)(!1),[V,B]=(0,n.useState)(""),[U,H]=(0,n.useState)({quiz:null,loading:!1,generating:!1,error:""}),[W,K]=(0,n.useState)({}),[Y,J]=(0,n.useState)(!1),X=(0,n.useRef)(!1),Z=(0,n.useRef)(!1),$=(0,n.useRef)(!1),ee=(0,n.useRef)(null!==(e=null===y||void 0===y||null===(a=y.dailyGoal)||void 0===a?void 0:a.lessonsCompletedToday)&&void 0!==e?e:0),ae=(0,n.useRef)(null!==(t=null===y||void 0===y||null===(i=y.streaks)||void 0===i||null===(h=i.lesson)||void 0===h?void 0:h.count)&&void 0!==t?t:0),te="Student"===(null===y||void 0===y?void 0:y.userType),le=(0,n.useMemo)(()=>{const e=(null===y||void 0===y?void 0:y._id)||(null===y||void 0===y?void 0:y.id)||(null===y||void 0===y?void 0:y.userId)||"guest";return"materialViewerNotes:".concat(e)},[null===y||void 0===y?void 0:y._id,null===y||void 0===y?void 0:y.id,null===y||void 0===y?void 0:y.userId]),ne=(0,n.useMemo)(()=>(e=>{if(!e)return[];if(Array.isArray(e.quizData)&&e.quizData.length)return e.quizData.map((e,a)=>{var t;return{front:e.question||e.front||"Card ".concat(a+1),back:e.answer||e.back||(null===(t=e.options)||void 0===t?void 0:t[e.correctIndex])||""}});if(e.textContent){const a=e.textContent.split(/\n-{3,}\n/).map(e=>e.trim()).filter(Boolean);if(a.length>1)return a.map((e,a)=>{const[t,...l]=e.split(/\n{2,}/);return{front:t||"Card ".concat(a+1),back:l.join("\n\n")||t}})}return[]})(S),[S]),se=(0,n.useMemo)(()=>(e=>{if(!e)return null;try{const a=["youtube.com","youtu.be"],t=new URL(e);if(!a.some(e=>t.hostname.includes(e)))return null;if(t.hostname.includes("youtu.be"))return"https://www.youtube.com/embed/".concat(t.pathname.replace("/",""));const l=t.searchParams.get("v");if(l)return"https://www.youtube.com/embed/".concat(l);const n=t.pathname.split("/"),s=n[n.length-1];return s?"https://www.youtube.com/embed/".concat(s):null}catch(a){return null}})(null===S||void 0===S?void 0:S.videoUrl),[S]),ie=(0,n.useRef)({running:!1,accumulatedMs:0,lastStart:null}),re=(0,n.useCallback)(()=>{ie.current={running:!1,accumulatedMs:0,lastStart:null}},[]),oe=(0,n.useCallback)(()=>{ie.current.running||(ie.current.running=!0,ie.current.lastStart=Date.now())},[]),ce=(0,n.useCallback)(()=>{ie.current.running&&(ie.current.accumulatedMs+=Date.now()-ie.current.lastStart,ie.current.running=!1,ie.current.lastStart=null)},[]),de=((0,n.useCallback)(()=>ie.current.running?Math.floor((ie.current.accumulatedMs+(Date.now()-ie.current.lastStart))/1e3):Math.floor(ie.current.accumulatedMs/1e3),[]),(0,n.useCallback)(()=>{var e,a;if(!S)return null;const t=S.annotations||{};return{id:S.id||S._id||S.content_id,playlist_id:S.playlist_id||(null===C||void 0===C?void 0:C.playlistId)||S.playlistId||j,order:null!==(e=null!==(a=S.order)&&void 0!==a?a:t.order)&&void 0!==e?e:0,annotations:{format:t.format||"Visual",type:t.type||"Abstract",category:t.category||"Video"}}},[S,null===C||void 0===C?void 0:C.playlistId,j]),(0,n.useCallback)(()=>{})),ue=(0,n.useCallback)(async()=>{if(j&&w){H(e=>(0,l.A)((0,l.A)({},e),{},{loading:!0,error:""}));try{const{data:e}=await d.A.get("/courses/".concat(j,"/materials/").concat(w,"/quiz"));H({quiz:(null===e||void 0===e?void 0:e.quiz)||null,loading:!1,generating:!1,error:""}),K({}),J(!1)}catch(e){H(a=>{var t,n;return(0,l.A)((0,l.A)({},a),{},{loading:!1,error:(null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||"Failed to load quiz"})})}}},[j,w]),me=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(j&&w){H(e=>(0,l.A)((0,l.A)({},e),{},{generating:!0,error:""}));try{const a="/courses/".concat(j,"/materials/").concat(w,"/quiz").concat(e?"?refresh=true":""),{data:t}=await d.A.post(a);H({quiz:(null===t||void 0===t?void 0:t.quiz)||null,loading:!1,generating:!1,error:""}),K({}),J(!1)}catch(a){H(e=>{var t,n;return(0,l.A)((0,l.A)({},e),{},{generating:!1,error:(null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||"Failed to generate quiz"})})}}},[j,w]);(0,n.useEffect)(()=>{H({quiz:null,loading:!1,generating:!1,error:""}),K({}),J(!1),ue()},[j,w,ue]);const he=(0,n.useCallback)(e=>{de(e).catch(()=>{})},[de]);(0,n.useEffect)(()=>{let e=!0;return(async()=>{z(!0);try{var a,t,l;const{data:n}=await d.A.get("/courses/".concat(j,"/materials/").concat(w));if(!e)return;k(n.course),A(n.material),"Quiz"!==(null===(a=n.material)||void 0===a||null===(t=a.annotations)||void 0===t?void 0:t.category)&&(Z.current=!0),Array.isArray(null===(l=n.material)||void 0===l?void 0:l.quizData)&&P(new Array(n.material.quizData.length).fill(null)),$.current=!1,re()}catch(i){var n,s;if(!e)return;o.oR.error((null===(n=i.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.error)||"Failed to load material"),N("/courses/".concat(j),{replace:!0})}finally{e&&z(!1)}})(),()=>{e=!1,he()}},[j,w,N,he,re]),(0,n.useEffect)(()=>{if(!te)return;if("undefined"===typeof window)return;X.current=!1;let e="";try{const a=window.localStorage.getItem(le);null!==a&&(e=a)}catch(a){console.warn("Failed to load notepad notes",a)}B(e),X.current=!0},[te,le]),(0,n.useEffect)(()=>{if(te&&"undefined"!==typeof window&&X.current)try{window.localStorage.setItem(le,V)}catch(e){console.warn("Failed to persist notepad notes",e)}},[V,te,le]),(0,n.useEffect)(()=>{var e,a;ee.current=null!==(e=null===y||void 0===y||null===(a=y.dailyGoal)||void 0===a?void 0:a.lessonsCompletedToday)&&void 0!==e?e:0},[null===y||void 0===y||null===(p=y.dailyGoal)||void 0===p?void 0:p.lessonsCompletedToday]),(0,n.useEffect)(()=>{var e,a,t;ae.current=null!==(e=null===y||void 0===y||null===(a=y.streaks)||void 0===a||null===(t=a.lesson)||void 0===t?void 0:t.count)&&void 0!==e?e:0},[null===y||void 0===y||null===(v=y.streaks)||void 0===v||null===(g=v.lesson)||void 0===g?void 0:g.count]);const xe=(null===S||void 0===S||null===(b=S.annotations)||void 0===b?void 0:b.format)||"Visual",pe=(0,n.useMemo)(()=>!!S&&("Visual"===xe?Boolean(se):"Audio"!==xe),[S,xe,se]);(0,n.useEffect)(()=>{if(!S)return;re(),$.current=!1,pe&&oe();const e=()=>{document.hidden?ce():pe&&oe()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e),ce()}},[S,pe,oe,ce,re]);const ve=(0,n.useCallback)(()=>{oe()},[oe]),ge=(0,n.useCallback)(()=>{ce()},[ce]),be=()=>{he(),"undefined"!==typeof window&&window.history.length>1?N(-1):N("/courses/".concat(j))},fe=e=>{if(e.preventDefault(),null===S||void 0===S||!S.quizData)return;let a=0;S.quizData.forEach((e,t)=>{E[t]===e.correctIndex&&(a+=1)}),T({correct:a,total:S.quizData.length}),I(!0),Z.current=!0,de(!0).catch(()=>{}),$.current=!1,re(),pe&&oe()},je=(null===S||void 0===S||null===(f=S.annotations)||void 0===f?void 0:f.category)||"Material",we=(null===S||void 0===S?void 0:S.description)||"",Ne=x(null===S||void 0===S?void 0:S.fileUrl),ye=null!==S&&void 0!==S&&S.videoUrl?x(S.videoUrl):"",_e=(null===S||void 0===S?void 0:S.textContent)||"";return q?(0,m.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#0f1117] text-white",children:(0,m.jsx)(r(),{color:"#14b8a6",size:32})}):S?(0,m.jsxs)("div",{className:"material-viewer-shell".concat(G?" material-viewer-shell--split":""),children:[te&&(0,m.jsxs)("button",{type:"button",className:"notepad-toggle".concat(G?" notepad-toggle--active":""),onClick:()=>{Q(e=>!e)},"aria-label":G?"Hide notepad":"Open notepad",children:[(0,m.jsx)(c.TPo,{}),(0,m.jsx)("span",{children:G?"Hide notes":"Open notes"})]}),(0,m.jsxs)("section",{className:"courses material-viewer-content",style:{minHeight:"100vh"},children:[(0,m.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,m.jsxs)("button",{type:"button",className:"option-btn flex items-center gap-2",onClick:be,children:[(0,m.jsx)(c.QVr,{})," Back"]}),(0,m.jsx)("span",{className:"text-sm text-slate-400",children:(null===C||void 0===C?void 0:C.title)||"Course"})]}),(0,m.jsxs)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"flex items-center gap-3 text-teal-400 text-sm uppercase tracking-widest mb-2",children:["Video"===je&&(0,m.jsx)(c.HiP,{}),"Audio"===je&&(0,m.jsx)(c.tLl,{}),"PDF"===je&&(0,m.jsx)(c.kl1,{}),"Reading"===je&&(0,m.jsx)(c.TPo,{}),(0,m.jsx)("span",{children:je})]}),(0,m.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:S.title}),we&&(0,m.jsx)("p",{className:"text-slate-300",children:we})]}),(()=>{if(!S)return null;switch(je){case"Video":case"Example":return se?(0,m.jsx)("div",{className:"material-media material-media--video",children:(0,m.jsx)("iframe",{title:S.title,src:"".concat(se,"?rel=0"),allow:"autoplay; fullscreen",className:"material-media__iframe",frameBorder:"0",allowFullScreen:!0})}):(0,m.jsx)("div",{className:"material-media material-media--video",children:(0,m.jsx)("video",{controls:!0,className:"material-media__player",src:ye,poster:x(S.thumb),onPlay:ve,onPause:ge,onEnded:()=>{ge(),Z.current=!0}})});case"Audio":return(0,m.jsxs)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg flex flex-col items-center gap-4",children:[(0,m.jsx)(c.tLl,{className:"text-4xl text-teal-400"}),(0,m.jsx)("audio",{controls:!0,src:Ne||ye,className:"w-full",onPlay:ve,onPause:ge,onEnded:()=>{ge(),Z.current=!0}})]});case"PDF":case"Reading":return Ne?(0,m.jsxs)("div",{className:"teacher-preview__pdf-wrapper",children:[(0,m.jsx)("iframe",{src:"".concat(Ne,"#toolbar=0"),title:S.title,className:"teacher-preview__pdf"}),(0,m.jsx)("button",{type:"button",className:"teacher-preview__expand",onClick:e=>{e.stopPropagation(),M(Ne)},"aria-label":"Expand PDF",children:"\u2197"})]}):(0,m.jsx)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg",children:(0,m.jsx)("p",{className:"text-slate-300 whitespace-pre-line",children:_e})});case"Concept Map":case"Outline":case"Exercise":return Ne?(0,m.jsx)("img",{src:Ne,alt:S.title,className:"w-full rounded-2xl shadow-lg object-contain bg-[#0f1117]"}):(0,m.jsx)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg",children:(0,m.jsx)("p",{className:"text-slate-300 whitespace-pre-line",children:_e})});case"Flashcards":if(!ne.length)return(0,m.jsx)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg",children:(0,m.jsx)("p",{className:"text-slate-300",children:"No flashcards available for this lesson yet."})});const e=ne[L];return(0,m.jsxs)("div",{className:"bg-[#1a1d2e] p-8 rounded-2xl shadow-lg flex flex-col items-center gap-6",children:[(0,m.jsxs)("div",{className:"w-full text-center",children:[(0,m.jsxs)("p",{className:"text-xs text-slate-400 mb-2",children:["Card ",L+1," of ",ne.length]}),(0,m.jsx)("div",{className:"bg-[#0f1117] rounded-xl p-6 text-white text-lg font-semibold shadow-inner",children:e.front})]}),(0,m.jsx)("div",{className:"bg-[#0f1117] rounded-xl p-6 text-slate-200 w-full shadow-inner",children:e.back||"Reveal the answer in class discussion."}),(0,m.jsxs)("div",{className:"flex gap-4",children:[(0,m.jsx)("button",{type:"button",className:"option-btn",onClick:()=>O(e=>(e-1+ne.length)%ne.length),children:"Previous"}),(0,m.jsx)("button",{type:"button",className:"inline-btn",onClick:()=>O(e=>(e+1)%ne.length),children:"Next"})]})]});case"Quiz":return S.quizData&&S.quizData.length?(0,m.jsxs)("form",{onSubmit:fe,className:"space-y-6",children:[S.quizData.map((e,a)=>(0,m.jsxs)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg space-y-4",children:[(0,m.jsxs)("h3",{className:"text-lg font-semibold text-white",children:["Question ",a+1]}),(0,m.jsx)("p",{className:"text-slate-300",children:e.question}),(0,m.jsx)("div",{className:"space-y-3",children:e.options.map((t,l)=>{const n=E[a]===l,s=D&&l===e.correctIndex,i=D&&n&&l!==e.correctIndex;return(0,m.jsxs)("label",{className:"flex items-center gap-3 p-3 rounded-xl border transition ".concat(s?"border-teal-400 bg-teal-400/10":i?"border-red-500 bg-red-500/10":"border-transparent bg-[#0f1117]"),children:[(0,m.jsx)("input",{type:"radio",name:"quiz-".concat(a),checked:n,onChange:()=>((e,a)=>{P(t=>{const l=[...t];return l[e]=a,l})})(a,l),disabled:D}),(0,m.jsx)("span",{className:"text-slate-200",children:t})]},"quiz-q-".concat(a,"-opt-").concat(l))})})]},"quiz-q-".concat(a))),(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[D?(0,m.jsxs)("div",{className:"flex items-center gap-3 text-teal-400",children:[(0,m.jsx)(c.A7C,{}),(0,m.jsxs)("span",{children:["You scored ",null===R||void 0===R?void 0:R.correct," out of ",null===R||void 0===R?void 0:R.total]})]}):(0,m.jsx)("button",{type:"submit",className:"inline-btn",children:"Submit Quiz"}),(0,m.jsx)("button",{type:"button",className:"option-btn",onClick:be,children:"Back to Materials"})]})]}):(0,m.jsx)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg",children:(0,m.jsx)("p",{className:"text-slate-300",children:"Quiz data is unavailable. Please check back later."})});default:return(0,m.jsx)("div",{className:"bg-[#1a1d2e] p-6 rounded-2xl shadow-lg",children:(0,m.jsx)("p",{className:"text-slate-300 whitespace-pre-line",children:_e||"Material will be available soon."})})}})(),"Quiz"!==je&&_e&&"Flashcards"!==je&&(0,m.jsxs)("div",{className:"bg-[#111827] p-6 rounded-2xl shadow-inner",children:[(0,m.jsx)("h2",{className:"text-xl font-semibold text-white mb-3",children:"Lesson Notes"}),(0,m.jsx)("p",{className:"text-slate-300 whitespace-pre-line",children:_e})]}),Ne&&"PDF"!==je&&"Audio"!==je&&"Video"!==je&&(0,m.jsx)("a",{href:Ne,target:"_blank",rel:"noreferrer",className:"inline-btn",children:"Download Resource"})]})]}),G&&(0,m.jsxs)("aside",{className:"material-notepad","aria-label":"Lesson notepad",children:[(0,m.jsxs)("header",{className:"material-notepad__header",children:[(0,m.jsxs)("div",{className:"material-notepad__title",children:[(0,m.jsx)(c.TPo,{}),(0,m.jsx)("span",{children:"My Notes"})]}),(0,m.jsx)("button",{type:"button",className:"material-notepad__action",onClick:()=>{if(B(""),"undefined"!==typeof window)try{window.localStorage.removeItem(le)}catch(e){console.warn("Failed to clear notepad notes",e)}},children:"Clear"})]}),(0,m.jsx)("p",{className:"material-notepad__hint",children:"Jot ideas, questions, or summaries as you review the material. Notes stay here until you close this browser session."}),(0,m.jsx)("textarea",{value:V,onChange:e=>{B(e.target.value)},placeholder:"Start typing your thoughts...",className:"material-notepad__textarea"})]}),F&&(0,m.jsx)("div",{className:"teacher-preview-modal",role:"dialog","aria-modal":"true","aria-label":"Expanded PDF",onClick:()=>M(null),children:(0,m.jsxs)("div",{className:"teacher-preview-modal__content",onClick:e=>e.stopPropagation(),children:[(0,m.jsx)("div",{className:"teacher-preview-modal__controls",children:(0,m.jsx)("button",{type:"button",className:"teacher-preview-modal__close",onClick:()=>M(null),"aria-label":"Close full size preview",children:"\xd7"})}),(0,m.jsx)("div",{className:"teacher-preview-modal__body",children:(0,m.jsx)("iframe",{title:"Expanded lesson preview",src:"".concat(x(F),"#toolbar=1"),className:"teacher-preview-modal__frame"})})]})}),(0,m.jsxs)("section",{className:"material-quiz-card",children:[(0,m.jsxs)("div",{className:"material-quiz-card__header",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h2",{children:"AI Practice Quiz"}),(0,m.jsx)("p",{children:"Let Gemini generate targeted questions from this material."})]}),(0,m.jsxs)("div",{className:"material-quiz-card__actions",children:[(0,m.jsx)("button",{type:"button",className:"inline-btn inline-btn--ghost",onClick:()=>ue(),disabled:U.loading||U.generating,children:"Refresh"}),(0,m.jsx)("button",{type:"button",className:"inline-btn",onClick:()=>me(Boolean(U.quiz)),disabled:U.generating,children:U.generating?"Generating\u2026":U.quiz?"Regenerate":"Generate Quiz"})]})]}),U.error&&(0,m.jsx)("p",{className:"text-red-400 mb-3",children:U.error}),U.loading?(0,m.jsx)("div",{className:"flex justify-center py-6",children:(0,m.jsx)(r(),{color:"#14b8a6"})}):U.quiz?(0,m.jsxs)("div",{className:"material-quiz-card__body",children:[U.quiz.questions.map((e,a)=>{var t;const n=W[a],s=Y&&n===e.answer,i=Y&&n&&n!==e.answer;return(0,m.jsxs)("article",{className:"quiz-question".concat(s?" quiz-question--correct":"").concat(i?" quiz-question--incorrect":""),children:[(0,m.jsxs)("h3",{children:[a+1,". ",e.question]}),(0,m.jsx)("div",{className:"quiz-options",children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,m.jsxs)("label",{className:"quiz-option",children:[(0,m.jsx)("input",{type:"radio",name:"quiz-".concat(a),value:e,checked:n===e,onChange:()=>((e,a)=>{K(t=>(0,l.A)((0,l.A)({},t),{},{[e]:a}))})(a,e),disabled:Y}),(0,m.jsx)("span",{children:e})]},"".concat(a,"-").concat(e)))}),Y&&(0,m.jsxs)("div",{className:"quiz-feedback",children:[(0,m.jsx)("p",{children:s?"Correct!":"Correct answer: ".concat(e.answer)}),e.explanation&&(0,m.jsx)("p",{className:"quiz-feedback__explanation",children:e.explanation})]})]},"quiz-".concat(a))}),!Y&&U.quiz.questions.length>0&&(0,m.jsx)("button",{type:"button",className:"inline-btn",onClick:()=>{U.quiz&&J(!0)},disabled:U.generating||U.loading,children:"Check Answers"})]}):(0,m.jsx)("p",{className:"muted",children:"No quiz has been generated for this material yet. Click \u201cGenerate Quiz\u201d to get started."})]})]}):null}}}]);
//# sourceMappingURL=809.4be90373.chunk.js.map