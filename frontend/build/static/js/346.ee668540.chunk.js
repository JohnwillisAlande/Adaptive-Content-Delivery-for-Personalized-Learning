"use strict";(self.webpackChunkapex101_frontend=self.webpackChunkapex101_frontend||[]).push([[346],{346:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var r=a(555),i=a(43),l=a(439),o=a(488),s=a(710),n=a(204),d=a(768),c=a(697),u=a(579);const p={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GEMINI_API_KEY:"AIzaSyCrxqeqgsp8qubxzmo4Yvzzh7S7-0hzXEc",REACT_APP_GOOGLE_CLIENT_ID:"776006269077-683ndu3i60s7o3tu1bn1m1rb3mukc03u.apps.googleusercontent.com"}.REACT_APP_FILE_BASE_URL||"http://localhost:5000",m=[{value:"Visual",label:"Visual (video, diagrams, animations)"},{value:"Verbal",label:"Verbal (text-heavy, lecture-style)"},{value:"Audio",label:"Audio (podcasts, spoken lectures)"}],h=[{value:"Abstract",label:"Abstract (theory, concepts, definitions)"},{value:"Concrete",label:"Concrete (worked examples, real cases)"}],v=[{value:"Video",label:"Video lesson"},{value:"Example",label:"Example or case study"},{value:"Exercise",label:"Practice exercise"},{value:"Quiz",label:"Quiz or assessment"},{value:"Reading",label:"Reading or article"},{value:"Outline",label:"Course outline / overview"},{value:"Concept Map",label:"Concept map / diagram"},{value:"Audio",label:"Audio lesson"},{value:"Flashcards",label:"Flashcards set"},{value:"PDF",label:"PDF handout or workbook"}],x=new Set(["Video","Example"]),f=new Set(["Reading","Exercise","Concept Map","Audio","Flashcards","PDF","Outline"]),b="Quiz",j=new Set(["Reading","Exercise","Flashcards","Outline"]),g=e=>e?e.startsWith("blob:")||e.startsWith("http")?e:e.startsWith("/")?"".concat(p).concat(e):"".concat(p,"/uploaded_files/").concat(e):"";const y=function(){const e=(0,l.Zp)(),{user:t,isAuthenticated:a,initializing:p}=(0,c.A)(),[y]=(0,l.ok)(),C=(0,i.useMemo)(()=>"Teacher"===(null===t||void 0===t?void 0:t.userType),[null===t||void 0===t?void 0:t.userType]),A=y.get("courseId")||"",_=y.get("materialId")||"",[q,N]=(0,i.useState)([]),[k,S]=(0,i.useState)({courseId:"",title:"",description:"",order:"",format:m[0].value,type:h[0].value,category:v[0].value,status:"active",videoSource:"upload",videoUrl:"",textContent:"",fileUrl:""}),[U,I]=(0,i.useState)(null),[R,w]=(0,i.useState)(""),[z,F]=(0,i.useState)(null),[E,T]=(0,i.useState)(null),[D,P]=(0,i.useState)(!1),[M,L]=(0,i.useState)(!1),[O,W]=(0,i.useState)(""),[V,Q]=(0,i.useState)(!0),[B,K]=(0,i.useState)(!1),[G,H]=(0,i.useState)(!1),[Y,J]=(0,i.useState)(null),[X,Z]=(0,i.useState)(null),[$,ee]=(0,i.useState)([{question:"",options:["","","",""],correctIndex:0}]);(0,i.useEffect)(()=>{if(!p)return a&&C?void te():(o.oR.error("Teacher access required"),void e("/home",{replace:!0}))},[p,a,C]);const te=async()=>{Q(!0);try{const{data:e}=await d.A.get("/courses/teacher/my");N(Array.isArray(e)?e:[])}catch(a){var e,t;o.oR.error((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"Failed to load courses")}finally{Q(!1)}};(0,i.useEffect)(()=>{V||(q.length?A&&q.find(e=>e._id===A)?S(e=>(0,r.A)((0,r.A)({},e),{},{courseId:A})):k.courseId||S(e=>(0,r.A)((0,r.A)({},e),{},{courseId:q[0]._id})):S(e=>(0,r.A)((0,r.A)({},e),{},{courseId:""})))},[V,q,A]),(0,i.useEffect)(()=>{if(!_||!C||V)return;(async()=>{K(!0);try{var e;const{data:t}=await d.A.get("/courses/teacher/materials/".concat(_));J(t._id);const a=(null===(e=t.annotations)||void 0===e?void 0:e.category)||v[0].value;S(e=>{var i,l,o;return(0,r.A)((0,r.A)({},e),{},{courseId:t.courseId||e.courseId||A||"",title:t.title||"",description:t.description||"",order:null!==(i=t.order)&&void 0!==i?i:"",format:(null===(l=t.annotations)||void 0===l?void 0:l.format)||m[0].value,type:(null===(o=t.annotations)||void 0===o?void 0:o.type)||h[0].value,category:a,status:t.status||"active",videoSource:t.video&&t.video.startsWith("http")?"link":"upload",videoUrl:t.video&&t.video.startsWith("http")?t.video:"",textContent:t.textContent||"",fileUrl:t.fileUrl&&t.fileUrl.startsWith("http")?t.fileUrl:""})}),w(g(t.thumbUrl||"")),Z(t.video?t.video.startsWith("http")?"link":"file":null),W(t.fileUrl||""),Array.isArray(t.quizData)&&t.quizData.length?ee(t.quizData.map(e=>({question:e.question||"",options:Array.isArray(e.options)&&e.options.length?[...e.options]:["","","",""],correctIndex:"number"===typeof e.correctIndex?e.correctIndex:0}))):ee([{question:"",options:["","","",""],correctIndex:0}]),T(null)}catch(i){var t,a;o.oR.error((null===(t=i.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"Failed to load material details")}finally{K(!1)}})()},[_,C,V]),(0,i.useEffect)(()=>{if(Y)return;const e=q.find(e=>e._id===k.courseId);e&&S(t=>(0,r.A)((0,r.A)({},t),{},{order:t.order||e.materialCount+1}))},[k.courseId,q,Y]);const ae=e=>{const{name:t,value:a}=e.target;if("category"===t){const e=x.has(a),t=f.has(a),i=a===b,l=j.has(a);return S(o=>(0,r.A)((0,r.A)({},o),{},{category:a,videoSource:e?o.videoSource:"upload",videoUrl:e?o.videoUrl:"",fileUrl:t?o.fileUrl:"",textContent:i||l?o.textContent:""})),e||(F(null),Z(null)),t||(T(null),W("")),void(i?0===$.length&&ee([{question:"",options:["","","",""],correctIndex:0}]):ee(e=>e.length?e:[{question:"",options:["","","",""],correctIndex:0}]))}S(e=>(0,r.A)((0,r.A)({},e),{},{[t]:a}))},re=e=>{if(!x.has(k.category))return;const{value:t}=e.target;S(e=>(0,r.A)((0,r.A)({},e),{},{videoSource:t,videoUrl:"link"===t?e.videoUrl:""})),"link"===t?(F(null),Z(e=>"link"===e?"link":null)):Z(e=>"file"===e?"file":null)};(0,i.useEffect)(()=>()=>{R&&R.startsWith("blob:")&&URL.revokeObjectURL(R)},[R]);const ie=(0,i.useMemo)(()=>x.has(k.category),[k.category]),le=(0,i.useMemo)(()=>f.has(k.category),[k.category]),oe=k.category===b,se=(0,i.useMemo)(()=>j.has(k.category),[k.category]),ne=(0,i.useMemo)(()=>g(O),[O]),de=(0,i.useMemo)(()=>{if(!O)return"";const e=O.split(/[/\\]/);return e[e.length-1]||""},[O]);return p||!C?(0,u.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#0f1117] text-white",children:(0,u.jsx)(s.A,{color:"#14b8a6",size:32})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("section",{className:"teachers upload-page",children:[(0,u.jsx)("h1",{className:"heading",children:Y?"Edit Course Material":"Upload Course Material"}),(0,u.jsx)("div",{className:"form-screen form-screen--plain form-screen--stacked",children:(0,u.jsxs)("div",{className:"form-card form-card--xl upload-card",children:[(0,u.jsx)("p",{className:"form-card__subtitle form-card__subtitle--left upload-card__intro",children:"Every field below feeds your adaptive learning engine. Use the lesson number to keep modules in sequence, select the primary format and purpose of the lesson, and label the category so the recommender can match students with the right activities. Accurate metadata keeps the ML models smart."}),V||B?(0,u.jsx)("div",{className:"form-loader",children:(0,u.jsx)(s.A,{color:"#14b8a6",size:32})}):(0,u.jsxs)("form",{onSubmit:async t=>{t.preventDefault();const a=Boolean(Y&&X),r=Boolean(Y&&O),i=k.textContent&&k.textContent.trim()?k.textContent.trim():"",l=k.fileUrl&&k.fileUrl.trim()?k.fileUrl.trim():"";if(!k.courseId)return void o.oR.error("Please choose a course");if(!k.title.trim()||!k.description.trim())return void o.oR.error("Title and description are required");if(!k.order||Number(k.order)<1)return void o.oR.error("Lesson number must be at least 1");if(!Y&&!U)return void o.oR.error("Thumbnail image is required for new materials");if(ie)if("link"===k.videoSource){if(!k.videoUrl.trim()&&(!a||"link"!==X))return void o.oR.error("Provide a video link or upload a video file")}else if(!z&&(!a||"file"!==X))return void o.oR.error("Upload a video file or switch to link mode");if(le&&!E&&!l&&!r&&(!se||!i))return void o.oR.error("Upload a file, provide a file link, or supply text instructions for this content type");let s=null;if(oe){s=$.map(e=>({question:e.question.trim(),options:e.options.map(e=>e.trim()),correctIndex:e.correctIndex}));for(const e of s){if(!e.question)return void o.oR.error("Each quiz question needs text");if(e.options.some(e=>!e))return void o.oR.error("Quiz questions require all answer options");if(e.correctIndex<0||e.correctIndex>=e.options.length)return void o.oR.error("Select a correct answer for each quiz question")}}H(!0);const n=new FormData;n.append("title",k.title.trim()),n.append("description",k.description.trim()),n.append("order",k.order),n.append("format",k.format),n.append("type",k.type),n.append("category",k.category),n.append("status",k.status),n.append("textContent",i),n.append("fileUrl",l),"link"===k.videoSource&&k.videoUrl.trim()?n.append("videoUrl",k.videoUrl.trim()):z&&n.append("videoFile",z),E&&n.append("contentFile",E),U&&n.append("thumb",U),oe&&s&&n.append("quizData",JSON.stringify(s));const c=Y?"/courses/teacher/".concat(k.courseId,"/materials/").concat(Y):"/courses/teacher/".concat(k.courseId,"/materials");try{Y?(await d.A.put(c,n,{headers:{"Content-Type":"multipart/form-data"}}),o.oR.success("Material updated")):(await d.A.post(c,n,{headers:{"Content-Type":"multipart/form-data"}}),o.oR.success("Material uploaded")),e("/teacher/courses")}catch(m){var u,p;o.oR.error((null===(u=m.response)||void 0===u||null===(p=u.data)||void 0===p?void 0:p.error)||"Failed to save material")}finally{H(!1)}},className:"upload-form form-grid-two",encType:"multipart/form-data",children:[(0,u.jsxs)("div",{className:"full-span",children:[(0,u.jsxs)("label",{htmlFor:"material-course",children:["Course ",(0,u.jsx)("span",{className:"required-indicator",children:"*"})]}),(0,u.jsx)("select",{id:"material-course",name:"courseId",value:k.courseId,onChange:ae,required:!0,children:q.map(e=>(0,u.jsx)("option",{value:e._id,children:e.title},e._id))})]}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("label",{htmlFor:"material-order",children:["Lesson number ",(0,u.jsx)("span",{className:"required-indicator",children:"*"})]}),(0,u.jsx)("input",{id:"material-order",type:"number",min:1,name:"order",value:k.order,onChange:ae,required:!0,placeholder:"1"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-format",children:"Primary format"}),(0,u.jsx)("select",{id:"material-format",name:"format",value:k.format,onChange:ae,children:m.map(e=>(0,u.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-type",children:"Content purpose"}),(0,u.jsx)("select",{id:"material-type",name:"type",value:k.type,onChange:ae,children:h.map(e=>(0,u.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-category",children:"Content category"}),(0,u.jsx)("select",{id:"material-category",name:"category",value:k.category,onChange:ae,children:v.map(e=>(0,u.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-status",children:"Material status"}),(0,u.jsxs)("select",{id:"material-status",name:"status",value:k.status,onChange:ae,children:[(0,u.jsx)("option",{value:"active",children:"Active \u2013 visible to students"}),(0,u.jsx)("option",{value:"deactive",children:"Inactive \u2013 hidden from students"})]}),(0,u.jsx)("p",{className:"field-hint",children:"Deactivate content to hide it from learners without deleting the file."})]}),(0,u.jsxs)("div",{className:"full-span",children:[(0,u.jsxs)("label",{htmlFor:"material-title",children:["Title ",(0,u.jsx)("span",{className:"required-indicator",children:"*"})]}),(0,u.jsx)("input",{id:"material-title",name:"title",value:k.title,onChange:ae,required:!0,placeholder:"Lesson title"})]}),(0,u.jsxs)("div",{className:"full-span",children:[(0,u.jsxs)("label",{htmlFor:"material-description",children:["Description ",(0,u.jsx)("span",{className:"required-indicator",children:"*"})]}),(0,u.jsx)("textarea",{id:"material-description",name:"description",value:k.description,onChange:ae,required:!0,rows:4,placeholder:"Summarize what this lesson covers"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-thumb",children:"Thumbnail image"}),(0,u.jsx)("input",{id:"material-thumb",type:"file",accept:"image/*",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];I(a||null),w(e=>(e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),a?URL.createObjectURL(a):e&&e.startsWith("blob:")?"":e))}}),R&&(0,u.jsx)("img",{src:R,alt:"Thumbnail preview",className:"form-preview"})]}),(0,u.jsxs)("div",{className:"form-checkbox",children:[(0,u.jsx)("input",{id:"material-featured",type:"checkbox",name:"featured",checked:k.featured,onChange:ae}),(0,u.jsx)("label",{htmlFor:"material-featured",children:"Mark as featured course"})]}),ie&&(0,u.jsxs)("div",{className:"full-span upload-form__segment",children:[(0,u.jsx)("label",{children:"Video source"}),(0,u.jsxs)("div",{className:"form-tab-group",children:[(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"radio",value:"upload",checked:"upload"===k.videoSource,onChange:re}),(0,u.jsx)("span",{children:"Upload file"})]}),(0,u.jsxs)("label",{children:[(0,u.jsx)("input",{type:"radio",value:"link",checked:"link"===k.videoSource,onChange:re}),(0,u.jsx)("span",{children:"YouTube / video link"})]})]}),"upload"===k.videoSource?(0,u.jsxs)("div",{className:"upload-form__field",children:[(0,u.jsx)("input",{type:"file",accept:"video/*",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];F(a||null),a&&Z("file")}}),"file"===X&&!z&&Y&&(0,u.jsx)("p",{className:"form-note",children:"Current video will be kept unless you upload a new file."})]}):(0,u.jsx)("input",{type:"url",name:"videoUrl",value:k.videoUrl,onChange:ae,placeholder:"https://www.youtube.com/watch?v=..."}),"link"===X&&"link"!==k.videoSource&&Y&&(0,u.jsx)("p",{className:"form-note",children:"Current linked video will remain unless you change it."})]}),le&&(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-file-upload",children:"Upload file (PDF, audio, etc.)"}),(0,u.jsx)("input",{id:"material-file-upload",type:"file",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];T(a||null),a&&W("")}}),O&&!E&&Y&&(0,u.jsxs)("p",{className:"form-note",children:["Current file:"," ",ne?(0,u.jsx)("a",{href:ne,target:"_blank",rel:"noreferrer",children:de}):(0,u.jsx)("span",{children:de})]})]}),le&&(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"material-file-url",children:"File link (optional)"}),(0,u.jsx)("input",{id:"material-file-url",type:"url",name:"fileUrl",value:k.fileUrl,onChange:ae,placeholder:"https://..."})]}),(le||oe)&&(0,u.jsxs)("div",{className:"full-span",children:[(0,u.jsx)("label",{htmlFor:"material-text-content",children:"Supporting text / instructions (optional)"}),(0,u.jsx)("textarea",{id:"material-text-content",name:"textContent",value:k.textContent,onChange:ae,rows:4,placeholder:"Add guidance, reading excerpts, or exercise instructions"})]}),oe&&(0,u.jsxs)("div",{className:"full-span quiz-builder",children:[(0,u.jsx)("label",{children:"Quiz builder"}),(0,u.jsxs)("div",{className:"quiz-builder__list",children:[$.map((e,t)=>(0,u.jsxs)("div",{className:"quiz-card",children:[(0,u.jsxs)("div",{className:"quiz-card__header",children:[(0,u.jsxs)("div",{className:"quiz-card__question",children:[(0,u.jsxs)("label",{htmlFor:"quiz-question-".concat(t),children:["Question ",t+1]}),(0,u.jsx)("input",{id:"quiz-question-".concat(t),type:"text",value:e.question,onChange:e=>{return a=t,i=e.target.value,void ee(e=>e.map((e,t)=>t===a?(0,r.A)((0,r.A)({},e),{},{question:i}):e));var a,i},placeholder:"Enter the quiz question"})]}),$.length>1&&(0,u.jsx)("button",{type:"button",className:"option-btn",onClick:()=>{return e=t,void ee(t=>t.length>1?t.filter((t,a)=>a!==e):t);var e},children:"Remove"})]}),(0,u.jsx)("div",{className:"quiz-card__options",children:e.options.map((a,i)=>(0,u.jsxs)("label",{className:"quiz-option",children:[(0,u.jsx)("input",{type:"radio",name:"question-".concat(t,"-correct"),checked:e.correctIndex===i,onChange:()=>((e,t)=>{ee(a=>a.map((a,i)=>i===e?(0,r.A)((0,r.A)({},a),{},{correctIndex:t}):a))})(t,i)}),(0,u.jsx)("input",{type:"text",value:a,onChange:e=>((e,t,a)=>{ee(i=>i.map((i,l)=>{if(l!==e)return i;const o=[...i.options];return o[t]=a,(0,r.A)((0,r.A)({},i),{},{options:o})}))})(t,i,e.target.value),placeholder:"Option ".concat(i+1)})]},"quiz-question-".concat(t,"-option-").concat(i)))})]},"quiz-question-".concat(t))),(0,u.jsx)("button",{type:"button",className:"inline-option-btn",onClick:()=>{ee(e=>[...e,{question:"",options:["","","",""],correctIndex:0}])},children:"Add another question"})]})]}),(0,u.jsxs)("div",{className:"full-span form-actions horizontal",children:[(0,u.jsx)("button",{type:"submit",className:"btn",disabled:G,children:G?(0,u.jsx)(s.A,{color:"#fff",size:18}):Y?"Update material":"Upload material"}),(0,u.jsx)("button",{type:"button",className:"option-btn",onClick:()=>e("/teacher/courses"),children:"Cancel"}),Y&&(0,u.jsx)("button",{type:"button",className:"delete-btn",onClick:()=>P(!0),disabled:G,children:"Delete material"})]})]})]})})]}),Y&&D&&(0,u.jsx)("div",{className:"danger-modal",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"danger-modal__card",children:[(0,u.jsx)("div",{className:"danger-modal__icon",children:(0,u.jsx)(n.BS8,{})}),(0,u.jsx)("h3",{className:"danger-modal__title",children:"Delete this material?"}),(0,u.jsx)("p",{className:"danger-modal__copy",children:"Removing this lesson erases its files and analytics permanently. Students will immediately lose access."}),(0,u.jsxs)("div",{className:"danger-modal__actions",children:[(0,u.jsx)("button",{type:"button",className:"delete-btn",onClick:async()=>{if(Y&&k.courseId){L(!0);try{await d.A.delete("/courses/teacher/".concat(k.courseId,"/materials/").concat(Y)),o.oR.success("Material deleted"),e("/teacher/courses")}catch(r){var t,a;o.oR.error((null===(t=r.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.error)||"Failed to delete material")}finally{L(!1),P(!1)}}},disabled:M,children:M?(0,u.jsx)(s.A,{size:18,color:"#fff"}):"Delete material"}),(0,u.jsx)("button",{type:"button",className:"option-btn",onClick:()=>P(!1),disabled:M,children:"Cancel"})]})]})})]})}}}]);
//# sourceMappingURL=346.ee668540.chunk.js.map